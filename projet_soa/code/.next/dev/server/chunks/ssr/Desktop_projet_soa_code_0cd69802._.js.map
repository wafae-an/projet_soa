{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AdMin/Desktop/projet_soa/code/actions/ticketActions.ts"],"sourcesContent":["'use server';\r\n\r\ninterface PurchaseTicketData {\r\n  userId: string;\r\n  ligneId: string;\r\n  routeName: string;\r\n  departureStation: string;\r\n  arrivalStation: string;\r\n  heureDepart?: string;\r\n  heureArrivee?: string;\r\n  dateRecherche: string;\r\n}\r\n\r\ninterface TicketResponse {\r\n  success: boolean;\r\n  ticket?: {\r\n    ticket_id: string;\r\n    user_id: string;\r\n    ligne_id: string;\r\n    ticket_code: string;\r\n    price: string;\r\n    status: string;\r\n    purchase_date: string;\r\n    valid_until: string;\r\n    route_name: string;\r\n    departure_station: string;\r\n    arrival_station: string;\r\n    heure_depart?: string;\r\n    heure_arrivee?: string;\r\n    is_valid: boolean;\r\n  };\r\n  message: string;\r\n}\r\n\r\n/**\r\n * Action serveur pour acheter un ticket (SANS transaction)\r\n */\r\nexport async function purchaseTicketWithTransaction(ticketData: PurchaseTicketData): Promise<{ \r\n  success: boolean; \r\n  message: string; \r\n  ticket?: any;\r\n  ticketCode?: string;\r\n}> {\r\n  try {\r\n    // Validation de l'userId\r\n    if (!ticketData.userId) {\r\n      return {\r\n        success: false,\r\n        message: 'ID utilisateur manquant'\r\n      };\r\n    }\r\n\r\n    // ‚úÖ CR√âATION DU TICKET SEULEMENT\r\n    const ticketPayload = {\r\n      user_id: ticketData.userId,\r\n      ligne_id: ticketData.ligneId,\r\n      route_name: ticketData.routeName,\r\n      departure_station: ticketData.departureStation,\r\n      arrival_station: ticketData.arrivalStation,\r\n      heure_depart: ticketData.heureDepart || '',\r\n      heure_arrivee: ticketData.heureArrivee || '',\r\n      purchase_date: ticketData.dateRecherche, // ‚Üê CORRECTION : Utiliser directement dateRecherche\r\n    };\r\n\r\n    console.log('üì§ Envoi cr√©ation ticket:', ticketPayload);\r\n\r\n    const ticketResponse = await fetch('http://localhost:9002/api/tickets/purchase/', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(ticketPayload)\r\n    });\r\n\r\n    // ‚úÖ Lire la r√©ponse brute pour debug\r\n    const responseText = await ticketResponse.text();\r\n    console.log('üì• R√©ponse brute Django:', responseText);\r\n\r\n    let ticketResult;\r\n    try {\r\n      ticketResult = JSON.parse(responseText);\r\n    } catch (e) {\r\n      console.error('‚ùå Erreur parsing JSON:', e);\r\n      return {\r\n        success: false,\r\n        message: 'R√©ponse invalide du serveur: ' + responseText\r\n      };\r\n    }\r\n\r\n    // ‚úÖ V√©rifier si c'est une erreur Django\r\n    if (!ticketResponse.ok) {\r\n      console.error('‚ùå Erreur Django:', ticketResult);\r\n      \r\n      // Am√©lioration du message d'erreur\r\n      let errorMessage = 'Erreur lors de la cr√©ation du ticket';\r\n      if (ticketResult.purchase_date) {\r\n        errorMessage = ticketResult.purchase_date[0]; // Message de validation Django\r\n      } else if (ticketResult.error) {\r\n        errorMessage = ticketResult.error;\r\n      } else if (ticketResult.detail) {\r\n        errorMessage = ticketResult.detail;\r\n      } else if (ticketResult.message) {\r\n        errorMessage = ticketResult.message;\r\n      }\r\n      \r\n      return {\r\n        success: false,\r\n        message: errorMessage\r\n      };\r\n    }\r\n\r\n    // ‚úÖ SUCC√àS: Ticket cr√©√©\r\n    console.log('‚úÖ Ticket cr√©√© avec succ√®s:', ticketResult);\r\n    \r\n    return {\r\n      success: true,\r\n      message: 'Ticket cr√©√© avec succ√®s',\r\n      ticket: ticketResult.ticket || ticketResult,\r\n      ticketCode: ticketResult.ticket?.ticket_code || ticketResult.ticket_code\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('‚ùå Erreur achat ticket:', error);\r\n    return {\r\n      success: false,\r\n      message: 'Erreur de connexion au serveur: ' + (error instanceof Error ? error.message : 'Unknown error')\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Action pour valider un ticket\r\n */\r\nexport async function validateTicket(ticketCode: string): Promise<{ \r\n  success: boolean; \r\n  message: string; \r\n  ticket?: any;\r\n}> {\r\n  try {\r\n    const response = await fetch('http://localhost:9002/api/tickets/validate/', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        ticket_code: ticketCode\r\n      })\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    return {\r\n      success: response.ok,\r\n      message: result.message || result.detail || 'Validation effectu√©e',\r\n      ticket: result.ticket || result\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Erreur validation ticket:', error);\r\n    return {\r\n      success: false,\r\n      message: 'Erreur de connexion au serveur'\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * R√©cup√©rer les tickets d'un utilisateur\r\n */\r\nexport async function getUserTickets(userId: string): Promise<{\r\n  success: boolean;\r\n  message: string;\r\n  tickets?: any[];\r\n}> {\r\n  try {\r\n    if (!userId) {\r\n      return {\r\n        success: false,\r\n        message: 'ID utilisateur manquant',\r\n        tickets: []\r\n      };\r\n    }\r\n\r\n    const response = await fetch(`http://localhost:9002/api/tickets/my_tickets/?user_id=${userId}`);\r\n    \r\n    if (!response.ok) {\r\n      return {\r\n        success: false,\r\n        message: 'Erreur lors de la r√©cup√©ration des tickets',\r\n        tickets: []\r\n      };\r\n    }\r\n\r\n    const result = await response.json();\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Tickets r√©cup√©r√©s avec succ√®s',\r\n      tickets: result.tickets || []\r\n    };\r\n\r\n  } catch (error) {\r\n    console.error('Erreur r√©cup√©ration tickets:', error);\r\n    return {\r\n      success: false,\r\n      message: 'Erreur de connexion au serveur',\r\n      tickets: []\r\n    };\r\n  }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AdMin/Desktop/projet_soa/code/.next-internal/server/app/passager/trajets/paiement/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {purchaseTicketWithTransaction as '40f3dcc0aaee20e2d661bdbab71ff52f71e2c175ba'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 178, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AdMin/Desktop/projet_soa/code/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/AdMin/Desktop/projet_soa/code/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}